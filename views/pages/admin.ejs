<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/css/admin.css" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
  </head>
  <body>
    <div class="row m-0 p-0">
      <div class="col-md-4 col-lg-3 vh-100 sidebar-container">
        <div class="sidebar">
          <div class="logo text-center p-2">
            <h1 onclick="window.open('/', '_self')">Urban Escape</h1>
          </div>
          <div class="menu">
            <ul style="list-style: none">
              <li data-link="home" class="active">Home</li>
              <li data-link="users">Users</li>
              <li data-link="routes">Routes</li>
              <li data-link="maplist">Map List</li>
              <li data-link="setting">Settings</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-8 col-lg-9">
        <div class="body-container vh-100" style="overflow-y: scroll">
          <div class="dynamic-container">
            <div class="vj_dynamic home">
              <div
                class="container d-flex justify-content-center align-items-center vh-100"
              >
                <div class="text-center">
                  <h3>Welcome</h3>
                  <img
                    class="lazy"
                    data-src="/images/dancer.gif"
                    width="200px"
                    alt="welcome dancer"
                  />
                  <p class="alert alert-warning">
                    Hello, Welcome Admin! Here you can manage all the stuff of
                    the Website!
                  </p>
                </div>
              </div>
            </div>
            <div class="vj_dynamic users">
              <div class="user-container mt-3">
                <div class="text-center text-md-start">
                  <a href="/admin/export/users" class="myBtn">Export Excel</a>
                </div>
                <table class="table table-striped datatable user">
                  <thead>
                    <tr>
                      <th>Sr no.</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Province</th>
                      <th>Radius</th>
                      <th>Since</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% let index = 1; %> <% users.forEach(user => { %> <% if
                    (user.role.current!="admin") { %>
                    <tr data-id="<%= user._id %>">
                      <td><%= index++ %></td>
                      <td><%= user.name %></td>
                      <td><%= user.email %></td>
                      <td><%= user.state %></td>
                      <td id="radiusVisual"><%= user.radius %></td>
                      <td>
                        <%= new Date(user.createdAt).toLocaleDateString('en-US')
                        %>
                      </td>
                      <td>
                        <button
                          class="btn btn-danger delete"
                          data-id="<%= user._id %>"
                        >
                          Delete
                        </button>
                        <button
                          class="btn btn-success changeRadius"
                          data-id="<%= user._id %>"
                        >
                          Radius
                        </button>
                      </td>
                    </tr>
                    <% } %> <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="vj_dynamic routes">
              <div class="MapControllerSetting">
                <div class="body-mapSetting">
                  <form class="map-countdown-update">
                    <div class="row">
                      <div class="col-5">
                        <input
                          type="date"
                          name="mapLaunchDate"
                          class="form-control"
                        />
                      </div>
                      <div class="col-4">
                        <input
                          type="time"
                          name="mapLaunchTime"
                          class="form-control"
                        />
                      </div>
                      <input type="hidden" name="id" />
                      <div class="col-3">
                        <button class="w-100 btn btn-success">update</button>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="visibility-toggle">
                  <span class="fa fa-arrow-up"></span>
                </div>
              </div>
              <div class="map-container">
                <div class="g-map vh-100"></div>
                <div class="map-controller" style="display: none">
                  <div class="d-flex bg-white p-2 rounded-2">
                    <button class="btn btn-outline-warning undo">Undo</button>
                    <button class="btn btn-outline-warning cpath">
                      Close Path
                    </button>
                    <button class="btn btn-outline-success save">Save</button>
                  </div>
                </div>
                <div class="game-mode-controller" style="display: none">
                  <div class="game-settings">
                    <div class="header">
                      <h3>Pacman Settings</h3>
                      <button class="btn btn-secondary">
                        <span class="fa fa-arrow-down"></span>
                      </button>
                    </div>
                    <div class="toggle-hide border-top mt-2 pt-2">
                      <div class="pacman-toggle-status">
                        <label class="custom-switch">
                          <input
                            type="checkbox"
                            id="pacmanGameActivationStatus"
                          />
                          <div class="custom-slider">
                            <div class="custom-slider-btn">
                              <div class="custom-light"></div>
                              <div class="custom-texture"></div>
                              <div class="custom-texture"></div>
                              <div class="custom-texture"></div>
                              <div class="custom-light"></div>
                            </div>
                          </div>
                        </label>
                      </div>
                      <div class="position-controller mb-2">
                        <button class="btn btn-success toggle-pacman-marker">
                          Set Initial Position
                        </button>
                      </div>
                      <div class="speed-controller mb-2">
                        <p class="m-0">
                          <label
                            >Pacman Speed (<span id="speed-control">0</span
                            >)</label
                          >
                        </p>
                        <input
                          type="range"
                          class="speed-control w-100"
                          min="0"
                          value="0"
                          max="100"
                        />
                      </div>
                      <div class="radius-controller">
                        <p class="m-0">
                          <label
                            >Pacman Attack Radius (<span id="radius-control"
                              >0</span
                            >)</label
                          >
                        </p>
                        <input
                          min="0"
                          max="100"
                          value="0"
                          type="range"
                          class="radius-control w-100"
                        />
                      </div>
                      <div class="my-2">
                        <button class="btn btn-info w-100 updatePacmanSettings">
                          Update Settings
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="vj_dynamic maplist">
              <div
                class="justify-content-center"
                style="
                  background: url(/images/game_mode.jpg) no-repeat;
                  background-size: cover;
                "
              >
                <form class="form my-5 bg-light p-3 m-0 new_map_form">
                  <h3 class="text-center m-0 mb-3">New Map</h3>
                  <div class="row">
                    <div class="col-12 col-md-6 col-lg-5 my-2">
                      <input
                        placeholder="Map Name"
                        class="form-control"
                        name="name"
                        id="name"
                      />
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 my-2">
                      <input
                        type="date"
                        class="form-control"
                        name="mapLaunchDate"
                        id="mapLaunchDate"
                      />
                    </div>
                    <div class="col-12 col-md-6 col-lg-2 my-2">
                      <input
                        type="time"
                        class="form-control"
                        name="mapLaunchTime"
                        id="mapLaunchTime"
                      />
                    </div>
                    <div class="col-12 col-md-6 col-lg-2 my-2">
                      <button class="w-100 btn btn-warning">Create</button>
                    </div>
                    <div class="col-12">
                      <input type="hidden" id="mapPlayableFlag" value="false" />
                      <a class="btn btn-primary" href="#" id="GameModeToggle">
                        <span class="fa fa-gamepad"></span> Enable Game Mode
                      </a>
                    </div>
                    <div class="col-12">
                      <div class="row" id="showGameOptions"></div>
                    </div>
                  </div>
                </form>
                <div
                  class="row justify-content-center missionsHandler"
                  style="display: none"
                >
                  <div class="missionEditor col-md-12 col-lg-6">
                    <h5 class="text-center pb-3 border-bottom m-0">Missions</h5>
                    <div class="missionEditContainer vh-50"></div>
                  </div>
                  <div class="missionsCreator text-center col-md-12 col-lg-6">
                    <p class="mb-1 mt-2">Set Missions</p>
                    <div class="form-group mb-2">
                      <input
                        placeholder="Mission Name"
                        class="form-control"
                        name="missionname"
                        id="missionname"
                      />
                    </div>
                    <div class="form-check form-switch text-start">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="badgeUrlToggle"
                        name="useBadges"
                        value="yes"
                      />
                      <label class="form-check-label" for="mySwitch"
                        >Use Badges instead of Redirect?</label
                      >
                    </div>
                    <div
                      class="badgePreview p-3 bg-light my-2 text-center"
                      style="display: none"
                    >
                      <img src="" alt="Badge" width="100px" />
                    </div>
                    <div class="form-group mb-2">
                      <input
                        placeholder="Redirect URL"
                        type="url"
                        class="form-control"
                        name="missionredirect"
                        id="missionurl"
                      />
                    </div>
                    <hr />
                    <% if (icons) { %>
                    <p class="m-0">Select Image</p>
                    <div class="mission-icons row">
                      <% icons.forEach(icon => { %>
                      <div
                        class="col-sm-4 p-2 border-1 rounded-1 text-center mission-icon-select"
                        data-src="<%= icon %>"
                      >
                        <img
                          class="lazy"
                          alt="<%= icon %>"
                          data-src="/images/mapicons/<%= icon %>"
                          width="100px"
                        />
                      </div>
                      <% }) %>
                    </div>
                    <p
                      class="bg-danger py-2 px-4 text-white rounded-2 d-inline-block"
                    >
                      <span id="selectedImagesCount">0</span> Image Selected
                    </p>
                    <a
                      class="btn btn-warning missionBtnSave w-100 my-2"
                      href="javascript:saveMission()"
                      style="display: none"
                    >
                      Save
                    </a>
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="col-12 my-2">
                <div class="card">
                  <div class="card-header">
                    <h3 class="text-center m-0">Badge Manager</h3>
                  </div>
                  <div class="card-body bg-light">
                    <div class="fileManagerBody">
                      <div class="loader text-center p-5">
                        <span class="fa fa-spinner fa-spin fa-3x"></span>
                      </div>
                      <div class="dirs" style="display: none">
                        <form class="new-dir m-0 p-0">
                          <div class="row">
                            <div class="col-9">
                              <input
                                type="text"
                                required
                                id="dirName"
                                placeholder="Enter Folder Name"
                                class="form-control"
                              />
                            </div>
                            <div class="col-3">
                              <button class="btn btn-success w-100">
                                Create New
                              </button>
                            </div>
                            <div class="col-12">
                              <div class="mt-4 text-center">
                                <a
                                  class="btn btn-success"
                                  href="/admin/export/badges"
                                >
                                  <span class="fa fa-upload"></span> Export
                                </a>
                                <a class="btn btn-primary importBadgeBTN">
                                  <span class="fa fa-download"></span> Import
                                </a>
                              </div>
                            </div>
                          </div>
                        </form>
                        <hr />
                        <div class="dir-container bg-white my-2 p-3 rounded-2">
                          <div class="row"></div>
                        </div>
                      </div>
                      <div
                        class="files px-2 py-3 bg-white rounded-2"
                        style="display: none"
                      >
                        <div
                          class="controllers mb-2 p-2 bg-light text-center rounded-2"
                        >
                          <button class="btn btn-info" title="Go Back">
                            <span class="fa fa-arrow-left"></span>
                          </button>
                          <button
                            class="btn btn-success ms-2"
                            title="Upload Badges"
                          >
                            <span class="fa fa-plus"></span>
                          </button>
                          <button
                            class="btn btn-danger ms-2"
                            title="Delete Folder"
                          >
                            <span class="fa fa-trash"></span>
                          </button>
                        </div>
                        <div
                          class="file-description row my-2"
                          style="display: none"
                        >
                          <div class="col-9">
                            <input
                              id="file-description"
                              class="form-control"
                              placeholder="Description"
                            />
                          </div>
                          <div class="col-3">
                            <button
                              class="btn w-100 btn-success saveFileDescription"
                            >
                              Save
                            </button>
                          </div>
                        </div>
                        <div class="file-container row"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <table class="table table-striped">
                <thead>
                  <th>Name</th>
                  <th>Link</th>
                  <th>Action</th>
                </thead>
                <tbody class="map_list"></tbody>
              </table>
            </div>
            <div class="vj_dynamic setting">
              <div class="container mt-4">
                <div class="row">
                  <div class="col-xl-6 my-2">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="text-center m-0">Provinces</h3>
                      </div>
                      <div class="card-body">
                        <div class="province-container">
                          <form
                            class="provinceMaker m-0 p-0 mb-2 pb-2 border-bottom"
                          >
                            <div class="d-flex">
                              <input
                                type="text"
                                class="form-control m-auto"
                                placeholder="Engter Province Name"
                                id="provinceName"
                              />
                              <button class="btn btn-warning ms-2">Save</button>
                            </div>
                          </form>
                          <table class="table table-striped datatable province">
                            <thead>
                              <tr>
                                <th>Name</th>
                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody class="province-table"></tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-6 my-2">
                    <div class="card h-100">
                      <div class="card-header">
                        <h3 class="m-0 text-center">User Map Settings</h3>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-3 text-center">
                            <div class="user_map_marker">
                              <img
                                src="/api/marker"
                                height="50px"
                                class="markerPreview"
                                alt="Map Marker"
                              />
                            </div>
                          </div>
                          <div class="col-6">
                            <div
                              class="h-100 d-flex justify-content-center align-items-center"
                            >
                              <button
                                class="btn btn-warning w-100 uploadNewMapMarker"
                              >
                                Change Marker
                              </button>
                            </div>
                          </div>
                          <div class="col-3">
                            <div
                              class="h-100 d-flex justify-content-center align-items-center"
                            >
                              <button
                                class="btn btn-danger w-100 deleteNewMapMarker"
                              >
                                Delete
                              </button>
                            </div>
                          </div>
                          <div class="col-9 mt-3">
                            <input
                              type="number"
                              id="userMapMarkerSize"
                              placeholder="User Marker Size (1-10)"
                              class="form-control"
                              min="1"
                              max="10"
                            />
                          </div>
                          <div class="col-3 my-3">
                            <button
                              class="btn btn-warning w-100 userMapMarkerSizeBtn"
                            >
                              Update
                            </button>
                          </div>
                          <hr />
                          <div class="col-12">
                            <p>Congrats Text</p>
                          </div>
                          <div class="col-9">
                            <textarea
                              class="form-control"
                              id="congratsText"
                              rows="3"
                            ></textarea>
                          </div>
                          <div class="col-3">
                            <button
                              class="btn btn-warning mt-auto updateBtntrigger"
                              data-id="congratsText"
                            >
                              Update
                            </button>
                          </div>
                          <div class="col-12 mt-3">
                            <p>Capture Button Text</p>
                          </div>
                          <div class="col-9">
                            <input
                              class="form-control"
                              id="captureBtnTextInput"
                            />
                          </div>
                          <div class="col-3">
                            <button
                              class="btn btn-warning mt-auto updateBtntrigger"
                              data-id="captureBtnTextInput"
                            >
                              Update
                            </button>
                          </div>
                          <div class="col-12 mt-3">
                            <p>Login Description</p>
                          </div>
                          <div class="col-9">
                            <textarea
                              class="form-control"
                              id="loginTextInput"
                              rows="3"
                            ></textarea>
                          </div>
                          <div class="col-3">
                            <button
                              class="btn btn-warning mt-auto updateBtntrigger"
                              data-id="loginTextInput"
                            >
                              Update
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-6 my-2">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="m-0 text-center">Image Management</h3>
                      </div>
                      <div class="card-body">
                        <div class="managed-image row"></div>
                        <button
                          class="btn btn-danger w-100 imageCleanerBtn"
                          style="display: none"
                        >
                          Delete All
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="col-xl-6 my-2">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="m-0 text-center">Image Center</h3>
                      </div>
                      <div class="card-body">
                        <a href="/admin/export/images" class="btn btn-success"
                          >Export</a
                        >
                        <button class="btn btn-info importImageBTN">
                          Import
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="col-xl-6 my-2">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="m-0 text-center">Button Center</h3>
                      </div>
                      <div class="card-body">
                        <form class="m-0 p-0 customButtonCreator">
                          <div class="row">
                            <div class="col-xl-6">
                              <input
                                class="form-control my-1"
                                placeholder="learn_more_btn"
                                type="text"
                                id="custombuttoncreator_name"
                              />
                            </div>
                            <div class="col-xl-6">
                              <input
                                class="form-control my-1"
                                placeholder="Learn More"
                                type="text"
                                id="custombuttoncreator_text"
                              />
                            </div>
                            <div class="col-xl-6">
                              <input
                                class="form-control my-1"
                                placeholder="https://google.com/"
                                type="url"
                                id="custombuttoncreator_url"
                              />
                            </div>
                            <div class="col-xl-6">
                              <button class="btn btn-success w-100 my-1">
                                <span class="fa fa-save"></span>
                              </button>
                            </div>
                          </div>
                        </form>
                        <table class="table">
                          <thead>
                            <tr>
                              <th>Name</th>
                              <th>Text</th>
                              <th>Link</th>
                              <th>Action</th>
                            </tr>
                          </thead>
                          <tbody class="customButtonList"></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="savePolyModal"
      tabindex="-1"
      aria-labelledby="savePolyModal"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              Route Manage
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="container">
              <form class="m-0 p-0" method="POST">
                <input type="hidden" name="polyCoords" />
                <div class="form-group mb-2">
                  <input
                    type="text"
                    id="routeTitle"
                    class="form-control"
                    placeholder="Enter Route Title"
                  />
                </div>
                <div class="form-group mb-2">
                  <textarea
                    rows="8"
                    id="routeDescription"
                    class="form-control"
                    placeholder="Enter Route Description"
                  ></textarea>
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Adjust Radius:</p>
                  <div class="row m-0 p-0">
                    <div class="col-sm-8">
                      <input
                        type="range"
                        oninput="setMapRadius(this)"
                        max="1000"
                        step="1"
                        value="0"
                        class="form-control"
                        placeholder="Radius of Image"
                        id="radiusRange"
                      />
                    </div>
                    <div class="col-sm-4">
                      <input
                        type="number"
                        oninput="setMapRadiusNum(this)"
                        max="1000"
                        step="1"
                        value="0"
                        class="form-control"
                        placeholder="Radius of Image"
                        id="radiusNum"
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Adjust Size:</p>
                  <div class="row m-0 p-0">
                    <div class="col-sm-8">
                      <input
                        type="range"
                        oninput="setMarkerSize(this)"
                        max="10"
                        step="1"
                        value="5"
                        class="form-control"
                        id="sizeRange"
                      />
                    </div>
                    <div class="col-sm-4">
                      <input
                        type="number"
                        oninput="setMarkerSizeNum(this)"
                        max="10"
                        step="1"
                        value="5"
                        class="form-control"
                        placeholder="Size of Image"
                        id="sizeNum"
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group mb-2">
                  <p>Opacity of Circle (0-100)</p>
                  <input
                    type="number"
                    min="0"
                    max="100"
                    value="100"
                    class="form-control"
                    id="loopOpacity"
                    oninput="setCircleOpacity(this)"
                  />
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Image Speed</p>
                  <input
                    type="number"
                    min="0"
                    value="1"
                    oninput="setMarkerSpeed(this)"
                    max="100"
                    id="imageSpeed"
                    class="form-control"
                  />
                </div>
                <% if (icons) { %>
                <p class="m-0">Select Image</p>
                <div class="icon-container row justify-content-center">
                  <% icons.forEach(icon => { %>
                  <div
                    class="col-sm-4 p-2 border-1 rounded-1 text-center icon-selector"
                    data-src="/images/mapicons/<%= icon %>"
                  >
                    <img
                      class="lazy"
                      alt="<%= icon %>"
                      data-src="/images/mapicons/<%= icon %>"
                      width="100px"
                    />
                  </div>
                  <% }) %>
                  <div class="col-sm-4 p-2 border-1 rounded-1 icon-selector">
                    <div class="addImage"></div>
                  </div>
                </div>
                <% } %>
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-danger me-auto delRouteBtn">Delete</button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Preview
            </button>
            <button type="button" class="btn btn-primary save_final">
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <input
      type="file"
      id="image-upload"
      accept="image/png, image/jpeg, image/gif"
      style="display: none"
    />
    <script src="/js/admin.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=marker&key=<%= apiKey %>"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      charset="utf-8"
      src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"
    ></script>
  </body>
</html>
