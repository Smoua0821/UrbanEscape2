<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/admin.css" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
  </head>
  <body>
    <div class="row m-0 p-0">
      <div class="col-md-4 col-lg-3 vh-100 sidebar-container">
        <div class="sidebar">
          <div class="logo text-center p-2">
            <h1 onclick="window.open('/', '_self')">Mappy</h1>
          </div>
          <div class="menu">
            <ul style="list-style: none">
              <li data-link="home" class="active">Home</li>
              <li data-link="users">Users</li>
              <li data-link="routes">Routes</li>
              <li data-link="maplist">Map List</li>
              <li data-link="setting">Settings</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-8 col-lg-9">
        <div class="body-container vh-100" style="overflow-y: scroll">
          <div class="dynamic-container">
            <div class="vj_dynamic home">
              <div
                class="container d-flex justify-content-center align-items-center vh-100"
              >
                <div class="text-center">
                  <h3>Welcome</h3>
                  <img
                    class="lazy"
                    data-src="/images/dancer.gif"
                    width="200px"
                    alt="welcome dancer"
                  />
                  <p class="alert alert-warning">
                    Hello, Welcome Admin! Here you can manage all the stuff of
                    the Website!
                  </p>
                </div>
              </div>
            </div>
            <div class="vj_dynamic users">
              <div class="user-container mt-3">
                <div class="text-center text-md-start">
                  <a href="/admin/export/users" class="myBtn">Export Excel</a>
                </div>
                <table class="table table-striped datatable user">
                  <thead>
                    <tr>
                      <th>Sr no.</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Province</th>
                      <th>Since</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% let index = 1; %> <% users.forEach(user => { %> <% if
                    (user.role.current!="admin") { %>
                    <tr data-id="<%= user._id %>">
                      <td><%= index++ %></td>
                      <td><%= user.name %></td>
                      <td><%= user.email %></td>
                      <td><%= user.state %></td>
                      <td>
                        <%= new Date(user.createdAt).toLocaleDateString('en-US')
                        %>
                      </td>
                      <td>
                        <button
                          class="btn btn-danger delete"
                          data-id="<%= user._id %>"
                        >
                          Delete
                        </button>
                      </td>
                    </tr>
                    <% } %> <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="vj_dynamic routes">
              <div class="map-container">
                <div class="g-map vh-100"></div>
                <div class="map-controller" style="display: none">
                  <div class="d-flex bg-white p-2 rounded-2">
                    <button class="btn btn-outline-warning undo">Undo</button>
                    <button class="btn btn-outline-warning cpath">
                      Close Path
                    </button>
                    <button class="btn btn-outline-success save">Save</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="vj_dynamic maplist">
              <div class="row justify-content-center">
                <form
                  class="form my-5 bg-light p-3 col-sm-10 col-md-8 col-lg-6 m-0 new_map_form"
                >
                  <h3 class="text-center m-0 mb-3">New Map</h3>
                  <div class="d-flex">
                    <input
                      placeholder="Map Name"
                      class="form-control"
                      name="name"
                      id="name"
                    />
                    <button class="ms-2 btn btn-warning">Create</button>
                  </div>
                </form>
                <div
                  class="row justify-content-center missionsHandler"
                  style="display: none"
                >
                  <div class="missionEditor col-md-12 col-lg-6">
                    <h5 class="text-center pb-3 border-bottom m-0">Missions</h5>
                    <div class="missionEditContainer vh-50"></div>
                  </div>
                  <div class="missionsCreator text-center col-md-12 col-lg-6">
                    <p class="mb-1 mt-2">Set Missions</p>
                    <div class="form-group mb-2">
                      <input
                        placeholder="Mission Name"
                        class="form-control"
                        name="missionname"
                        id="missionname"
                      />
                    </div>
                    <div class="form-group mb-2">
                      <input
                        placeholder="Redirect URL"
                        type="url"
                        class="form-control"
                        name="missionredirect"
                        id="missionurl"
                      />
                    </div>
                    <% if (icons) { %>
                    <p class="m-0">Select Image</p>
                    <div class="mission-icons row">
                      <% icons.forEach(icon => { %>
                      <div
                        class="col-sm-4 p-2 border-1 rounded-1 text-center mission-icon-select"
                        data-src="<%= icon %>"
                      >
                        <img
                          class="lazy"
                          alt="<%= icon %>"
                          data-src="/images/mapicons/<%= icon %>"
                          width="100px"
                        />
                      </div>
                      <% }) %>
                    </div>
                    <p
                      class="bg-danger py-2 px-4 text-white rounded-2 d-inline-block"
                    >
                      <span id="selectedImagesCount">0</span> Image Selected
                    </p>
                    <a
                      class="btn btn-warning missionBtnSave w-100 my-2"
                      href="javascript:saveMission()"
                      style="display: none"
                    >
                      Save
                    </a>
                    <% } %>
                  </div>
                </div>
              </div>
              <table class="table table-striped">
                <thead>
                  <th>Name</th>
                  <th>Link</th>
                  <th>Action</th>
                </thead>
                <tbody class="map_list"></tbody>
              </table>
            </div>
            <div class="vj_dynamic setting">
              <div class="container mt-4">
                <div class="row">
                  <div class="col-xl-6">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="text-center m-0">Provinces</h3>
                      </div>
                      <div class="card-body">
                        <div class="province-container">
                          <form
                            class="provinceMaker m-0 p-0 mb-2 pb-2 border-bottom"
                          >
                            <div class="d-flex">
                              <input
                                type="text"
                                class="form-control m-auto"
                                placeholder="Engter Province Name"
                                id="provinceName"
                              />
                              <button class="btn btn-warning ms-2">Save</button>
                            </div>
                          </form>
                          <table class="table table-striped datatable province">
                            <thead>
                              <tr>
                                <th>Name</th>
                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody class="province-table"></tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-6">
                    <div class="card">
                      <div class="card-header">
                        <h3 class="m-0 text-center">Primary Map</h3>
                      </div>
                      <div class="card-body">
                        <div class="primary-map-card">
                          <p class="m-0 h5 text-center bg-light p-2 rounded-2">
                            Calgary
                          </p>
                          <div class="d-flex mt-3">
                            <select
                              class="form-select m-auto primaryMapSelector"
                            ></select>
                            <button class="btn btn-warning ms-2">Update</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="savePolyModal"
      tabindex="-1"
      aria-labelledby="savePolyModal"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              Route Manage
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="container">
              <form class="m-0 p-0" method="POST">
                <input type="hidden" name="polyCoords" />
                <div class="form-group mb-2">
                  <input
                    type="text"
                    id="routeTitle"
                    class="form-control"
                    placeholder="Enter Route Title"
                  />
                </div>
                <div class="form-group mb-2">
                  <textarea
                    rows="8"
                    id="routeDescription"
                    class="form-control"
                    placeholder="Enter Route Description"
                  ></textarea>
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Adjust Radius:</p>
                  <div class="row m-0 p-0">
                    <div class="col-sm-8">
                      <input
                        type="range"
                        oninput="setMapRadius(this)"
                        max="1000"
                        step="1"
                        value="0"
                        class="form-control"
                        placeholder="Radius of Image"
                        id="radiusRange"
                      />
                    </div>
                    <div class="col-sm-4">
                      <input
                        type="number"
                        oninput="setMapRadiusNum(this)"
                        max="1000"
                        step="1"
                        value="0"
                        class="form-control"
                        placeholder="Radius of Image"
                        id="radiusNum"
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Adjust Size:</p>
                  <div class="row m-0 p-0">
                    <div class="col-sm-8">
                      <input
                        type="range"
                        oninput="setMarkerSize(this)"
                        max="10"
                        step="1"
                        value="5"
                        class="form-control"
                        id="sizeRange"
                      />
                    </div>
                    <div class="col-sm-4">
                      <input
                        type="number"
                        oninput="setMarkerSizeNum(this)"
                        max="10"
                        step="1"
                        value="5"
                        class="form-control"
                        placeholder="Size of Image"
                        id="sizeNum"
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group mb-2">
                  <p>Opacity of Circle (0-100)</p>
                  <input
                    type="number"
                    min="0"
                    max="100"
                    value="100"
                    class="form-control"
                    id="loopOpacity"
                    oninput="setCircleOpacity(this)"
                  />
                </div>
                <div class="form-group mb-2">
                  <p class="m-0">Image Speed</p>
                  <input
                    type="number"
                    min="1"
                    value="1"
                    oninput="setMarkerSpeed(this)"
                    max="10"
                    id="imageSpeed"
                    class="form-control"
                  />
                </div>
                <% if (icons) { %>
                <p class="m-0">Select Image</p>
                <div class="icon-container row justify-content-center">
                  <% icons.forEach(icon => { %>
                  <div
                    class="col-sm-4 p-2 border-1 rounded-1 text-center icon-selector"
                    data-src="/images/mapicons/<%= icon %>"
                  >
                    <img
                      class="lazy"
                      alt="<%= icon %>"
                      data-src="/images/mapicons/<%= icon %>"
                      width="100px"
                    />
                  </div>
                  <% }) %>
                  <div class="col-sm-4 p-2 border-1 rounded-1 icon-selector">
                    <div class="addImage"></div>
                  </div>
                </div>
                <% } %>
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Preview
            </button>
            <button type="button" class="btn btn-primary save_final">
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <input
      type="file"
      id="image-upload"
      accept="image/png, image/jpeg, image/gif"
      style="display: none"
    />
    <script src="/js/admin.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=marker&key=<%= apiKey %>"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      charset="utf-8"
      src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"
    ></script>
  </body>
</html>
